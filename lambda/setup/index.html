<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This workshop is going to take you through the best-in-class observability platform for ingesting, monitoring, visualizing metrics and logs to troubleshoot real-world performance issues"><meta name=author content="Splunk Team"><link href=https://splunk.github.io/imt-workshop/lambda/setup/ rel=canonical><link rel=icon href=../../images/favicon.ico><meta name=generator content="mkdocs-1.1.2, mkdocs-material-7.1.5"><title>Workshop Setup - Splunk Infrastructure Monitoring and Troubleshooting Workshop</title><link rel=stylesheet href=../../assets/stylesheets/main.bde7dde4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ef6f36e2.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#workshop-setup class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Splunk Infrastructure Monitoring and Troubleshooting Workshop" class="md-header__button md-logo" aria-label="Splunk Infrastructure Monitoring and Troubleshooting Workshop" data-md-component=logo> <img src=../../images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Splunk Infrastructure Monitoring and Troubleshooting Workshop </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Workshop Setup </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary data-md-color-accent type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary data-md-color-accent type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/splunk/imt-workshop title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../eks/readme-b/ class=md-tabs__link> Amazon EKS </a> </li> <li class=md-tabs__item> <a href=../../otel/ class=md-tabs__link> Splunk IMT </a> </li> <li class=md-tabs__item> <a href=../../splunk/ class=md-tabs__link> <b>Splunk Cloud</b> </a> </li> <li class=md-tabs__item> <a href=../../resources/ class=md-tabs__link> Resources </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Splunk Infrastructure Monitoring and Troubleshooting Workshop" class="md-nav__button md-logo" aria-label="Splunk Infrastructure Monitoring and Troubleshooting Workshop" data-md-component=logo> <img src=../../images/logo.png alt=logo> </a> Splunk Infrastructure Monitoring and Troubleshooting Workshop </label> <div class=md-nav__source> <a href=https://github.com/splunk/imt-workshop title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 data-md-state=indeterminate type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Amazon EKS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Amazon EKS" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Amazon EKS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../eks/readme-b/ class=md-nav__link> Get EKS Cluster </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 data-md-state=indeterminate type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Splunk IMT <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Splunk IMT" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Splunk IMT </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../otel/ class=md-nav__link> Workshop Introduction </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 data-md-state=indeterminate type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2> Get Data In<br><small>15 minutes</small> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Get Data In<br /><small>15 minutes</small>" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Get Data In<br><small>15 minutes</small> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../otel/k3s/ class=md-nav__link> Deploy the OTel Collector </a> </li> <li class=md-nav__item> <a href=../../otel/nginx/ class=md-nav__link> Deploy and monitor NGINX </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 data-md-state=indeterminate type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3> Dashboards<br><small>20 minutes</small> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Dashboards<br /><small>20 minutes</small>" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Dashboards<br><small>20 minutes</small> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dashboards/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../dashboards/editing/ class=md-nav__link> Editing charts </a> </li> <li class=md-nav__item> <a href=../../dashboards/savingcharts/ class=md-nav__link> Saving charts </a> </li> <li class=md-nav__item> <a href=../../dashboards/filtering/ class=md-nav__link> Using filters & formulas </a> </li> <li class=md-nav__item> <a href=../../dashboards/signalflow/ class=md-nav__link> SignalFlow </a> </li> <li class=md-nav__item> <a href=../../dashboards/adding-charts/ class=md-nav__link> Adding more charts </a> </li> <li class=md-nav__item> <a href=../../dashboards/dashboarding/ class=md-nav__link> Notes and layout </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 data-md-state=indeterminate type=checkbox id=__nav_3_4 checked> <label class=md-nav__link for=__nav_3_4> Detectors<br><small>10 minutes</small> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Detectors<br /><small>10 minutes</small>" data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Detectors<br><small>10 minutes</small> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../detectors/ class=md-nav__link> Creating a Detector </a> </li> <li class=md-nav__item> <a href=../../detectors/muting/ class=md-nav__link> Creating a Muting Rule </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 data-md-state=indeterminate type=checkbox id=__nav_3_5 checked> <label class=md-nav__link for=__nav_3_5> Monitoring as Code<br><small>10 minutes</small> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Monitoring as Code<br /><small>10 minutes</small>" data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Monitoring as Code<br><small>10 minutes</small> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../monitoring-as-code/ class=md-nav__link> Plan, Apply and Destroy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6 data-md-state=indeterminate type=checkbox id=__nav_3_6 checked> <label class=md-nav__link for=__nav_3_6> Service Bureau<br><small>10 minutes</small> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Service Bureau<br /><small>10 minutes</small>" data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Service Bureau<br><small>10 minutes</small> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../servicebureau/billing-and-usage/ class=md-nav__link> Billing and Usage </a> </li> <li class=md-nav__item> <a href=../../servicebureau/teams/ class=md-nav__link> Teams </a> </li> <li class=md-nav__item> <a href=../../servicebureau/tokens/ class=md-nav__link> Control Usage </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 data-md-state=indeterminate type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> <b>Splunk Cloud</b> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="<b>Splunk Cloud</b>" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> <b>Splunk Cloud</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1 data-md-state=indeterminate type=checkbox id=__nav_4_1 checked> <label class=md-nav__link for=__nav_4_1> <b>Signing up and Getting Started</b><br><small>30 minutes</small> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="<b>Signing up and Getting Started</b><br /><small>30 minutes</small>" data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> <b>Signing up and Getting Started</b><br><small>30 minutes</small> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../splunk/ class=md-nav__link> Signing Up </a> </li> <li class=md-nav__item> <a href=../../splunk/splunkindex/ class=md-nav__link> Creating Index </a> </li> <li class=md-nav__item> <a href=../../splunk/hectoken/ class=md-nav__link> Creating HEC Token </a> </li> <li class=md-nav__item> <a href=../../splunk/sck/ class=md-nav__link> Deploying Splunk Connect for Kubernetes </a> </li> <li class=md-nav__item> <a href=../../splunk/datalinks/ class=md-nav__link> Setting up Data Links for Contextual Logging </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 data-md-state=indeterminate type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Resources <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Resources data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../resources/ class=md-nav__link> Links </a> </li> <li class=md-nav__item> <a href=../../resources/faq/ class=md-nav__link> FAQ </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=workshop-setup>Workshop Setup<a class=headerlink href=#workshop-setup title="Permanent link">&para;</a></h1> <p>This setup module is used to prepare a set of AWS Lambda Functions and EC2 Instances to be used for the workshop, these will need to be created by an AWS Admin who has access to a suitable account that can be used for the workshop.</p> <p>There will be 4 Lambda Functions and 1 EC2 instance deployed for each participant. Every resource will be prefixed with a Unique ID (UID) to identify which attendee they belong to.</p> <p>Terraform is used to deploy all of the resources and this module details the steps required to install and configure terraform, configure it to authenticate with AWS, and then deploy the resources.</p> <hr> <h2 id=1-install-terraform>1. Install Terraform<a class=headerlink href=#1-install-terraform title="Permanent link">&para;</a></h2> <p>Terraform is used to deploy all of the AWS infrastructure for the workshop, so needs to be installed on your machine. Instructions on how to install Terraform can be found <a href=https://learn.hashicorp.com/tutorials/terraform/install-cli target=_blank>here</a>.</p> <h3 id=terraform-aws-authentication>Terraform AWS Authentication<a class=headerlink href=#terraform-aws-authentication title="Permanent link">&para;</a></h3> <p>Once Terraform is installed, you need to configure it to authenticate with your AWS Account. Details on AWS Authentication can be found <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs#authentication target=_blank>here</a>.</p> <p>The AWS Authentication consists of two files, <code>config</code> and <code>credentials</code> which are typically located in the <code>~/.ssh</code> folder.</p> <p>The <code>config</code> file details different profiles, and works in conjunction with the <code>credentials</code> file which contains your <code>access</code> and <code>secret</code> keys.</p> <div class=tabbed-set data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><label for=__tabbed_1_1>config</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>[default]
region = us-east-1
output = json
[profile splunk]
region = us-east-1
output = json
</code></pre></div> </div> <input id=__tabbed_1_2 name=__tabbed_1 type=radio><label for=__tabbed_1_2>authentication</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>[default]
aws_access_key_id = {your access key}
aws_secret_access_key = {your secret key}
[splunk]
aws_access_key_id = {your access key}
aws_secret_access_key = {your secret key}
</code></pre></div> </div> </div> <hr> <h2 id=2-clone-workshop-content-will-need-to-update-url-once-published-to-splunk-repo>2. Clone Workshop Content - WILL NEED TO UPDATE URL ONCE PUBLISHED TO SPLUNK REPO<a class=headerlink href=#2-clone-workshop-content-will-need-to-update-url-once-published-to-splunk-repo title="Permanent link">&para;</a></h2> <p>The Workshop Content needs to be pulled down from Github to your local machine, then updated with your specific settings for AWS Authentication.</p> <h3 id=21-download-the-workshop-repo>2.1 Download the Workshop Repo<a class=headerlink href=#21-download-the-workshop-repo title="Permanent link">&para;</a></h3> <p>Git Clone</p> <div class=tabbed-set data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><label for=__tabbed_2_1>git clone</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>git clone https://github.com/geoffhigginbottom/tflambdatestv2.git
</code></pre></div> </div> <input id=__tabbed_2_2 name=__tabbed_2 type=radio><label for=__tabbed_2_2>example result</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>Workshop git clone https://github.com/geoffhigginbottom/tflambdatestv2.git
cloning into &#39;tflambdatestv2&#39;...
remote: Enumerating objects: 276, done.
remote: Counting objects: 100% (276/276), done.
remote: Compressing objects: 100% (186/186), done.
remote: Total 276 (delta 159), reused 206 (delta 89), pack-reused 0
Receiving objects: 100% (276/276), 269.48 KiB | 1.13 MiB/s, done.
Resolving deltas: 100% (159/159), done.
</code></pre></div> </div> </div> <hr> <h3 id=22-create-terraformtfvars>2.2 Create terraform.tfvars<a class=headerlink href=#22-create-terraformtfvars title="Permanent link">&para;</a></h3> <p>A file called terraform.tfvars needs to be created and populated with your specific settings. This file contains all of the settings required to enable Terraform to connect to both your AWS and Splunk Environments.</p> <p>An example version of the file is included in the repo named <code>terraform.tfvars.example</code>, which you should copy and rename to <code>terraform.tfvars</code>. Run the following command from within the directory where the workshop content was download.</p> <div class=tabbed-set data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><label for=__tabbed_3_1>crete terraform.tfvars</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>cp terraform.tfvars.example terraform.tfvars
</code></pre></div> </div> </div> <p>Then update the newly created <code>terraform.tfvars</code>starting with the AWS Variables Section.</p> <h4 id=221-aws-variables-section>2.2.1 AWS Variables Section<a class=headerlink href=#221-aws-variables-section title="Permanent link">&para;</a></h4> <ul> <li> <p><code>profile</code> should match the profile name used in your aws <code>authentication</code> file which Terraform will use to authenticate with AWS</p> </li> <li> <p><code>key_name</code> is the name of the ssh_key you wish to use to access the EC2 instances (note password login is also enabled on the Instances)</p> </li> <li> <p><code>private_key_path</code> is the path to your private ssh key, such as <code>~/.ssh/xxx.pem</code> or <code>~/.ssh/id_rsa</code></p> </li> <li> <p><code>instance_type</code> is the AWS Instance Type used for the EC2 Instances - this defaults to the free tier "t2.micro"</p> </li> <li> <p><code>region</code> is an optional parameter, normally left commented out. It enables you to override the region prompt during the Terraform deployment</p> </li> </ul> <div class=tabbed-set data-tabs=4:1><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><label for=__tabbed_4_1>terraform.tfvars - AWS Variables</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>### AWS Variables ###
profile = &quot;xxx&quot;
key_name = &quot;yyy&quot;
private_key_path = &quot;~/.ssh/xxx.pem or ~/.ssh/id_rsa etc&quot;
instance_type = &quot;t2.micro&quot;

## Terraform will prompt you to select an AWS Region to deploy the resources into
## Setting a region here removes the region prompt (default is to have it prompt you)
## List of supported regions can be found in the variables.tf file
#region = &quot;2&quot;
</code></pre></div> </div> </div> <h4 id=222-splunk-variables-section>2.2.2 Splunk Variables Section<a class=headerlink href=#222-splunk-variables-section title="Permanent link">&para;</a></h4> <ul> <li> <p><code>function_version</code> is an optional parameter, normally left commented out. It enables you to override the version prompt during the Terraform deployment</p> </li> <li> <p><code>access_token</code> is the token you wish to use to authenticate with the Splunk Monitoring backend</p> </li> <li> <p><code>realm</code> specifies which Realm your Splunk Monitoring backend is deployed in</p> </li> <li> <p><code>collector_image</code> specifies the contributor version of the otel collector, and the latest version can be found <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/releases target=_blank>here</a> and will need updating as new versions are released</p> </li> </ul> <div class=tabbed-set data-tabs=5:1><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><label for=__tabbed_5_1>terraform.tfvars - Splunk Variables</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>### Splunk Variables ###

## Terraform will prompt you to select a version to be deployed,
## &quot;a&quot; = apm version, &quot;b&quot; = base version.
## Base version is typically deployed, but the apm version can be deployed 
## for testing and comparison purposes
#function_version = &quot;b&quot;

access_token = &quot;xxxxxxxxxx&quot;
realm = &quot;xxx&quot;

# smart_agent_version = &quot;5.6.0-1&quot; # Optional - If left blank, latest will be installed
smart_agent_version = &quot;&quot; # Optional - If left blank, latest will be installed

## Latest otel collector releases can be found at 
## https://github.com/open-telemetry/opentelemetry-collector-contrib/releases
collector_image = &quot;otel/opentelemetry-collector-contrib:0.15.0&quot;
</code></pre></div> </div> </div> <hr> <h3 id=23-generate-the-unique-ids>2.3 Generate the Unique IDs<a class=headerlink href=#23-generate-the-unique-ids title="Permanent link">&para;</a></h3> <p>A file named <code>quantity.auto.tfvars</code> needs to be created and populated with your specific settings. This file contains the Unique IDs which will be appended to each AWS Resource to identify which workshop participant they are allocated to.</p> <p>There is an example file in the repo called <code>quantity.auto.tfvars.example</code> which needs to be copied and renamed to <code>quantity.auto.tfvars</code>. Run the following command from within the directory where the workshop content was download.</p> <div class=tabbed-set data-tabs=6:1><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><label for=__tabbed_6_1>crete quantity.auto.tfvars</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>cp quantity.auto.tfvars.example quantity.auto.tfvars
</code></pre></div> </div> </div> <p>Edit <code>quantity.auto.tfvars</code> and populate the list of participants, ensuring each value is unique and has no spaces. Ensure the <code>function_count</code> value equals the total number of names, and that each entry ends with a comma, apart from the last one, as per the example below.</p> <div class=tabbed-set data-tabs=7:1><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><label for=__tabbed_7_1>quantity.auto.tfvars</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>function_count = &quot;3&quot;
function_ids = [
    &quot;John&quot;,
    &quot;Sarah&quot;,
    &quot;Amir&quot;
    ]
</code></pre></div> </div> </div> <hr> <h2 id=3-initialize-terraform>3. Initialize Terraform<a class=headerlink href=#3-initialize-terraform title="Permanent link">&para;</a></h2> <p>Once you have finished creating and updating <code>xxx</code> and <code>yyy</code> you now need to initialize terraform, so run the following command:</p> <div class=tabbed-set data-tabs=8:2><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><label for=__tabbed_8_1>Terraform init</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>teraform init
</code></pre></div> </div> <input id=__tabbed_8_2 name=__tabbed_8 type=radio><label for=__tabbed_8_2>Example output</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>Initializing the backend...

Initializing provider plugins...
- Finding latest version of terraform-providers/docker...
- Finding latest version of hashicorp/null...
- Finding latest version of hashicorp/archive...
- Finding latest version of hashicorp/aws...
- Installing hashicorp/archive v2.0.0...
- Installed hashicorp/archive v2.0.0 (signed by HashiCorp)
- Installing hashicorp/aws v3.18.0...
- Installed hashicorp/aws v3.18.0 (signed by HashiCorp)
- Installing terraform-providers/docker v2.7.2...
- Installed terraform-providers/docker v2.7.2 (signed by HashiCorp)
- Installing hashicorp/null v3.0.0...
- Installed hashicorp/null v3.0.0 (signed by HashiCorp)

The following providers do not have any version constraints in configuration,
so the latest version was installed.

To prevent automatic upgrades to new major versions that may contain breaking
changes, we recommend adding version constraints in a required_providers block
in your configuration, with the constraint strings suggested below.

* hashicorp/archive: version = &quot;~&gt; 2.0.0&quot;
* hashicorp/aws: version = &quot;~&gt; 3.18.0&quot;
* hashicorp/null: version = &quot;~&gt; 3.0.0&quot;
* terraform-providers/docker: version = &quot;~&gt; 2.7.2&quot;


Warning: Additional provider information from registry

The remote registry returned warnings for
registry.terraform.io/terraform-providers/docker:
- For users on Terraform 0.13 or greater, this provider has moved to
kreuzwerker/docker. Please update your source in required_providers.

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
</code></pre></div> </div> </div> <h2 id=4-deploy-the-workshop>4. Deploy the Workshop<a class=headerlink href=#4-deploy-the-workshop title="Permanent link">&para;</a></h2> <h3 id=41-terraform-plan>4.1 Terraform Plan<a class=headerlink href=#41-terraform-plan title="Permanent link">&para;</a></h3> <p>You can now deploy the workshop using Terraform. It is always best practice to run a <code>plan</code> so you can check what changes Terraform is going to make. When executing Terraform will prompt you to select a version of the workshop (select <code>b</code> for base), and also an AWS Region (choose an appropriate one from the list)</p> <div class=tabbed-set data-tabs=9:2><input checked=checked id=__tabbed_9_1 name=__tabbed_9 type=radio><label for=__tabbed_9_1>Terraform plan</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>terraform plan

var.function_version
    Select Function Version (a:apm, b:base)

    Enter a value: b

var.region
    Select region (1:eu-west-1, 2:eu-west-3, 3:eu-central-1, 4:us-east-1, 5:us-east-2, 6:us-west-1, 7:us-west-2, 8:ap-southeast-1, 9:ap-southeast-2, 10:sa-east-1 )

    Enter a value: 2
</code></pre></div> </div> <input id=__tabbed_9_2 name=__tabbed_9 type=radio><label for=__tabbed_9_2>Example output</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>terraform plan

var.function_version
    Select Function Version (a:apm, b:base)

    Enter a value: b

var.region
    Select region (1:eu-west-1, 2:eu-west-3, 3:eu-central-1, 4:us-east-1, 5:us-east-2, 6:us-west-1, 7:us-west-2, 8:ap-southeast-1, 9:ap-southeast-2, 10:sa-east-1 )

    Enter a value: 2

Refreshing Terraform state in-memory prior to plan...
The refreshed state will be used to calculate this plan, but will not be
persisted to local or remote state storage.

data.aws_ami.latest-ubuntu: Refreshing state...

------------------------------------------------------------------------

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
+ create
&lt;= read (data resources)

Terraform will perform the following actions:

# data.archive_file.retailorder_lambda_zip will be read during apply
# (config refers to values not yet known)
&lt;= data &quot;archive_file&quot; &quot;retailorder_lambda_zip&quot;  {
    + id                  = (known after apply)
    + output_base64sha256 = (known after apply)
    + output_md5          = (known after apply)
    + output_path         = &quot;retailorder_lambda.zip&quot;
    + output_sha          = (known after apply)
    + output_size         = (known after apply)
    + source_file         = &quot;retailorder_lambda_function.py&quot;
    + type                = &quot;zip&quot;
    }

........
EXTRA LINES REMOVED 
........

Plan: 106 to add, 0 to change, 0 to destroy.

------------------------------------------------------------------------

Note: You didn&#39;t specify an &quot;-out&quot; parameter to save this plan, so Terraform
can&#39;t guarantee that exactly these actions will be performed if
&quot;terraform apply&quot; is subsequently run.
</code></pre></div> </div> </div> <h3 id=43-terraform-apply>4.3 Terraform Apply<a class=headerlink href=#43-terraform-apply title="Permanent link">&para;</a></h3> <p>After checking the plan output looks OK, you can now <code>apply</code> the deployment, using the same options as when you ran the <code>plan</code>, and entering <code>yes</code> when prompted:</p> <div class=tabbed-set data-tabs=10:2><input checked=checked id=__tabbed_10_1 name=__tabbed_10 type=radio><label for=__tabbed_10_1>Terraform apply</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>terraform apply

var.function_version
    Select Function Version (a:apm, b:base)

    Enter a value: b

var.region
    Select region (1:eu-west-1, 2:eu-west-3, 3:eu-central-1, 4:us-east-1, 5:us-east-2, 6:us-west-1, 7:us-west-2, 8:ap-southeast-1, 9:ap-southeast-2, 10:sa-east-1 )

    Enter a value: 2

Plan: 106 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
    Terraform will perform the actions described above.
    Only &#39;yes&#39; will be accepted to approve.

    Enter a value: yes
</code></pre></div> </div> <input id=__tabbed_10_2 name=__tabbed_10 type=radio><label for=__tabbed_10_2>Example output</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>Apply complete! Resources: 106 added, 0 changed, 0 destroyed.

Outputs:

OTC_Instances = [
&quot;john_otc, 52.47.138.166&quot;,
&quot;sarah_otc, 15.188.51.119&quot;,
&quot;amir_otc, 35.180.230.215&quot;,
]
retaildiscount_invoke_url = [
&quot;John_RetailOrderDiscount_api_gateway, o91dr4o3c6.execute-api.eu-west-3.amazonaws.com&quot;,
&quot;Sarah_RetailOrderDiscount_api_gateway, leelg1e0y9.execute-api.eu-west-3.amazonaws.com&quot;,
&quot;Amir_RetailOrderDiscount_api_gateway, 0gdlkj8ceb.execute-api.eu-west-3.amazonaws.com&quot;,
]
retailorder_arns = [
&quot;John_RetailOrder, arn:aws:lambda:eu-west-3:527477237977:function:John_RetailOrder&quot;,
&quot;Sarah_RetailOrder, arn:aws:lambda:eu-west-3:527477237977:function:Sarah_RetailOrder&quot;,
&quot;Amir_RetailOrder, arn:aws:lambda:eu-west-3:527477237977:function:Amir_RetailOrder&quot;,
]
retailorder_invoke_url = [
&quot;John_RetailOrder_api_gateway, https://286kkhj9k1.execute-api.eu-west-3.amazonaws.com/default&quot;,
&quot;Sarah_RetailOrder_api_gateway, https://rgv6lwdf81.execute-api.eu-west-3.amazonaws.com/default&quot;,
&quot;Amir_RetailOrder_api_gateway, https://5lnuuesqz3.execute-api.eu-west-3.amazonaws.com/default&quot;,
]
retailorderdiscount_arns = [
&quot;John_RetailOrderDiscount, arn:aws:lambda:eu-west-3:527477237977:function:John_RetailOrderDiscount&quot;,
&quot;Sarah_RetailOrderDiscount, arn:aws:lambda:eu-west-3:527477237977:function:Sarah_RetailOrderDiscount&quot;,
&quot;Amir_RetailOrderDiscount, arn:aws:lambda:eu-west-3:527477237977:function:Amir_RetailOrderDiscount&quot;,
]
retailorderdiscount_path = [
&quot;John_RetailOrderDiscount, /default/John_RetailOrderDiscount&quot;,
&quot;Sarah_RetailOrderDiscount, /default/Sarah_RetailOrderDiscount&quot;,
&quot;Amir_RetailOrderDiscount, /default/Amir_RetailOrderDiscount&quot;,
]
retailorderline_arns = [
&quot;John_RetailOrderLine, arn:aws:lambda:eu-west-3:527477237977:function:John_RetailOrderLine&quot;,
&quot;Sarah_RetailOrderLine, arn:aws:lambda:eu-west-3:527477237977:function:Sarah_RetailOrderLine&quot;,
&quot;Amir_RetailOrderLine, arn:aws:lambda:eu-west-3:527477237977:function:Amir_RetailOrderLine&quot;,
]
retailorderprice_arns = [
&quot;John_RetailOrderPrice, arn:aws:lambda:eu-west-3:527477237977:function:John_RetailOrderPrice&quot;,
&quot;Sarah_RetailOrderPrice, arn:aws:lambda:eu-west-3:527477237977:function:Sarah_RetailOrderPrice&quot;,
&quot;Amir_RetailOrderPrice, arn:aws:lambda:eu-west-3:527477237977:function:Amir_RetailOrderPrice&quot;,
]
retailorderprice_invoke_url = [
&quot;John_RetailOrderPrice_api_gateway, https://gohem8pwib.execute-api.eu-west-3.amazonaws.com/default&quot;,
&quot;Sarah_RetailOrderPrice_api_gateway, https://dv23py0xo0.execute-api.eu-west-3.amazonaws.com/default&quot;,
&quot;Amir_RetailOrderPrice_api_gateway, https://dv1rn91g83.execute-api.eu-west-3.amazonaws.com/default&quot;,
]
</code></pre></div> </div> </div> <h2 id=43-what-did-we-deploy>4.3 What Did We Deploy?<a class=headerlink href=#43-what-did-we-deploy title="Permanent link">&para;</a></h2> <p>Assuming a successful deployment, if you check in your AWS Console you should find the following (with multiple versions where UID matches the user names from <code>quantity.auto.tfvars</code>):</p> <ul> <li>Lambda Functions</li> <li>UID_RetailOrder</li> <li>UID_RetailOrderDiscount</li> <li>UID_RetailOrderLine</li> <li> <p>UID_RetailOrderPrice</p> </li> <li> <p>Lambda Layers</p> </li> <li> <p>request-opentracing_2_0</p> </li> <li> <p>Instances</p> </li> <li> <p>UID_otc</p> </li> <li> <p>API Gateways</p> </li> <li>UID_RetailOrder_api_gateway</li> <li>UID_RetailOrderDiscount_api_gateway</li> <li> <p>UID_RetailOrderPrice_api_gateway</p> </li> <li> <p>IAM Roles</p> </li> <li> <p>splunk_lambda_role_xxxxxxxxxx</p> </li> <li> <p>IAM Policies</p> </li> <li>lambda_initiate_lambda_policy_xxxxxxxxxxx</li> </ul> <hr> <div class=md-source-date> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">May 26, 2021</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" title="Back to top" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2021 Splunk Inc. All rights reserved. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/splunk/imt-workshop target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/splunk target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://www.linkedin.com/company/splunk/ target=_blank rel=noopener title=www.linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.sections", "navigation.expand", "navigation.top", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.d351de03.min.js", "version": 1.0}</script> <script src=../../assets/javascripts/bundle.a1609d9a.min.js></script> </body> </html>